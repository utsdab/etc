#!/bin/bash
echo ""
echo "STARTING: ${BASH_SOURCE}"
echo "VERSION: 2017-01-27"
echo "USER: ${USER}"
export PATH="/usr/X11R6/bin:${PATH}"

########################## SETUP STUDIO WIDE ENVIRONMENT HOOKS
if [ -d ${DABRENDER} ]; then
    echo "CHECK   : DABRENDER SEEMS TO BE THERE ${DABRENDER}"
else
    echo "CRITICAL: Cant see DABRENDER ${DEBRENDER}"
    unset DABRENDER
fi

##########################  DEV or PRODUCTION
if [ ${DABDEV} ]; then
    echo ">>>>>>>>> DEVELOPMENT: Using the development paths"
    _dabusr="${DABDEV}/usr"
    _dabetc="${DABDEV}/etc"
    _dabsww="${DABDEV}/sww"
    _dabwork="${DABRENDER}/work"
    _dabassets="${DABRENDER}/assets"
    _dabuserprefs="${_dabwork}/user_prefs"
else
    echo "PRODUCTION: Using the studio paths"
    _dabusr="${DABRENDER}/usr"
    _dabetc="${DABRENDER}/etc"
    _dabsww="${DABRENDER}/sww"
    _dabwork="${DABRENDER}/work"
    _dabassets="${DABRENDER}/assets"
    _dabuserprefs="${DABRENDER}/work/user_prefs"
fi

######### DABUSR - this is the main location presently for all things in our suite of farm scripts
if [ -d ${_dabusr} ]; then
    export DABUSR="${_dabusr}"
    echo "INFO    : DABUSR = ${DABUSR}"
else
    echo "CRITICAL: Cant set DABUSR correctly ${_dabusr}"
    unset DABUSR
fi

######### DABETC
if [ -d ${_dabetc} ]; then
    export DABETC="${_dabetc}"
    echo "INFO    : DABETC = ${DABETC}"
else
    echo "CRITICAL: Cant set DABETC correctly ${_dabetc}"
    unset DABETC
fi

######## DABSWW
if [ -d ${_dabsww} ]; then
    export DABSWW="${_dabsww}"
    echo "INFO    : DABSWW = ${DABSWW}"
else
    echo "CRITICAL: Cant set DABSWW correctly ${_dabsww}"
    unset DABSWW
fi

######### DABWORK - the main work area hook
if [ -d ${_dabwork} ]; then
    export DABWORK="${_dabwork}"
    echo "INFO    : DABWORK = ${DABWORK}"
else
    echo "CRITICAL: Cant set DABWORK correctly ${_dabwork}"
    unset DABWORK
fi

######### DABASSETS - an asset library hook
if [ -d ${_dabassets} ]; then
    export DABASSETS="${_dabassets}"
    echo "INFO    : DABASSETS = ${DABASSETS}"
else
    echo "CRITICAL: Cant set DABASSETS correctly ${_dabassets}"
    unset DABASSETS
fi

######### DABUSERPREFS  this is a place for user preferences to be centrally (in lieu of a home directory)
if [ -d ${_dabuserprefs} ]; then
    export DABUSERPREFS="${_dabuserprefs}"
    echo "INFO    : DABUSERPREFS = ${DABUSERPREFS}"
else
    echo "CRITICAL: Cant set DABUSERPREFS correctly ${_dabuserprefs}"
    unset DABUSERPREFS
fi

######### MAYA_APP_DIR  this is a place for user preferences to be centrally (in lieu of a home directory)
# config is normally a link to the current CONFIG_vXX with mayaprefs inside
_MAYA_APP_DIR="${DABUSERPREFS}/${USER}/config/mayaprefs"
if [ -d ${_MAYA_APP_DIR} ]; then
    export MAYA_APP_DIR="${_MAYA_APP_DIR}"
    echo "INFO    : MAYA_APP_DIR = ${MAYA_APP_DIR}"
else
    echo "CRITICAL: Cant set MAYA_APP_DIR correctly as ${_MAYA_APP_DIR}"
    unset MAYA_APP_DIR
fi

##########################
export MAYA_VERSION="2017"
echo "INFO    : MAYA VERSION   : $MAYA_VERSION"
export RMAN_VERSION="21.3"
echo "INFO    : RMAN_VERSION   : $RMAN_VERSION"
export TRACTOR_VERSION="2.2"
echo "INFO    : TRACTOR_VERSION: $TRACTOR_VERSION"
export NUKE_VERSION="10.5v3"
echo "INFO    : NUKE_VERSION   : $NUKE_VERSION"
echo "INFO    : OS             : ${OSTYPE:0:5}"
##########################

case ${OSTYPE:0:5} in
linux)
    export RMANTREE="/opt/pixar/RenderManProServer-${RMAN_VERSION}"
    export RMSTREE="/opt/pixar/RenderManStudio-${RMAN_VERSION}-maya${MAYA_VERSION}"
    export TRACTOR_LOCATION="/opt/pixar/Tractor-${TRACTOR_VERSION}"
    export MAYA_APPLICATION_LOCATION="/usr/autodesk/maya${MAYA_VERSION}"
    export MAYA_LOCATION="${MAYA_APPLICATION_LOCATION}"
    ;;
darwi)
    export RMANTREE="/Applications/Pixar/RenderManProServer-${RMAN_VERSION}"
    export RMSTREE="/Applications/Pixar/RenderManStudio-${RMAN_VERSION}-maya${MAYA_VERSION}"
    export TRACTOR_LOCATION="/Applications/Pixar/Tractor-${TRACTOR_VERSION}"
    export MAYA_APPLICATION_LOCATION="/Applications/Autodesk/maya${MAYA_VERSION}"
    export MAYA_LOCATION="${MAYA_APPLICATION_LOCATION}/Maya.app/Contents"
    export NUKE_INSTALL_PATH="/Applications/Nuke${NUKE_VERSION}"
    export NUKE_LOCATION="${NUKE_INSTALL_PATH}/Nuke$NUKE_VERSION.app"
    export NUKE_TEMP_DIR="/var/tmp/nuke-${USER}"
    export PATH="${NUKE_INSTALL_PATH}/Nuke${NUKE_VERSION}.app/Contents/MacOS:${PATH}"
    export PATH="/usr/aw/COM/bin:/usr/aw/COM/etc:${PATH}"
    export PATH="/Applications/RV64.app/Contents/MacOS:${PATH}"
    export MAYA_RENDER_DESC_PATH="/Applications/solidangle/mtoa/2017/arnoldRenderer.xml:${MAYA_RENDER_DESC_PATH}"
    ;;
*)
    echo "WARNING:   LIBRARY_PATH and base environment NOT set in profile.d/dabanim.sh"
    ;;
esac

#  DABRENDER is set in /etc/profile.d/dabanim.sh and is OS aware
#  These are locations for central scripts and python scripts common to osx and linux eg perl, shell, python:wq
#  Not entirely sure what the dirrernce between RDIR and RMS_SCRIPT_PATHS is
export RMS_SCRIPT_PATHS="${DABETC}/pixar/config-${RMAN_VERSION}"
export RDIR="${DABETC}/pixar/config-${RMAN_VERSION}"
export PIXAR_LICENSE_FILE="${DABETC}/pixar/pixar.license"
export foundry_LICENSE="${DABETC}/foundry/foundry_license.lic"
export RV_LICENSE_FILE="${DABETC}/tweak/license.gto"
export TWEAK_LICENSE_FILE="${DABETC}/tweak/license.gto"
export MU_MODULE_PATH="${DABUSR}/etc/tweak/mu"
export SGTK_DESKTOP_CONFIG_LOCATION="${DABWORK}/shotgun_configs"
export solidangle_LICENSE="/Applications/solidAngleLicense"


# WORKAROUND for libMC3.so.8 error in Maya2016 (added by Chris Bell 10/9/15
export MAYA_DISABLE_CIP=1
export MAYA_MAC_SET_UMASK=0

##########################  PATH settings
export PATH=${DABUSR}/bin:${PATH}
export PATH=${DABSWW}/renderfarm/bin:${PATH}
export PATH=${RMANTREE}/bin:${PATH}
export PATH=${RMSTREE}/bin:${PATH}
export PATH=${TRACTOR_LOCATION}/bin:${PATH}
export PATH=${MAYA_LOCATION}/bin:${PATH}
export PATH=${DABUSR}/etc/tractor:${PATH}

##########################  PYTHONPATH settings
# getting PySide2 from Maya2017 distro
export PYTHONPATH="${MAYA_LOCATION}/Frameworks/Python.framework/Versions/Current/lib/python2.7/site-packages":${PYTHONPATH}

export PYTHONPATH=${DABRENDER}:${PYTHONPATH}
export PYTHONPATH=${RMSTREE}/scripts:${PYTHONPATH}
export PYTHONPATH=${DABSWW}/renderfarm:${PYTHONPATH}
export PYTHONPATH=${DABUSR}/etc/tractor:${PYTHONPATH}
export PYTHONPATH=${TRACTOR_LOCATION}/lib/python2.7/site-packages:${PYTHONPATH}

########################## copy of tractor package only
##### need to do this as we dont want all the other site-packages from tractor and rmstree like pyside etc
#export PYTHONPATH=${DABUSR}/lib/site-packages:${PYTHONPATH}
#export PYTHONPATH=${PYTHONPATH}:${RMSTREE}/lib/python2.7/site-packages
#export PYTHONPATH="${OCIO_EXECROOT}/lib/python2.7/site-packages:${PYTHONPATH}"

##########################  NUKE settings
#export NUKE_PATH="${OCIO_EXECROOT}/lib/nuke:${NUKE_PATH}"
#export NUKE_PATH="${OCIO_ROOT}/share/nuke:${NUKE_PATH}";
#export NUKE_PATH="${DABUSR}/etc/nuke/tractorNuke:${NUKE_PATH}";

###########################  ALIAS's
alias nukex='Nuke${NUKE_VERSION} --nukex'
alias nukestudio='Nuke${NUKE_VERSION} --studio'
alias nukeassist='Nuke${NUKE_VERSION} --nukeassist'
alias nukeple='Nuke${NUKE_VERSION} --PLE'
alias nuke='Nuke${NUKE_VERSION}'
alias maya='maya'
alias tqd='tq --engine tractor-engine:5600'
alias myprefs='open `myprefs.py`'
alias mywork='open `mywork.py`'


# if [ ${CONFIG} ] ; then
# echo  "INFO    : CONFIG is ${CONFIG} "
#     export MAYA_APP_DIR="${CONFIG}/mayaConfig"
# else
# 	echo  "WARNING: CONFIG not found still "
# fi


##########################
echo     "ENDING  : ${BASH_SOURCE}"
echo ""
